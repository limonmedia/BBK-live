{"generator":"Code Snippets v3.6.8","date_created":"2025-06-13 05:51","snippets":[{"id":19,"name":"variations of canves on click ","code":"add_action('woocommerce_before_single_variation', 'custom_variation_selector_with_stock');\n\nfunction custom_variation_selector_with_stock() {\n    global $product;\n\n    if (!is_product() || (wp_doing_ajax() && isset($_REQUEST['action']) && $_REQUEST['action'] === 'woosq_quickview')) {\n        return;\n    }\n\n    $available_variations = $product->get_available_variations();\n    $attributes = $product->get_variation_attributes();\n\t\n    usort($available_variations, function($a, $b) {\n        $size_label_a = implode('\/', array_values($a['attributes']));\n        $size_label_b = implode('\/', array_values($b['attributes']));\n        return strnatcasecmp($size_label_a, $size_label_b);\n    });\n\t\n    echo '<style>\n        .woosq-product.variations_form.variations { display: block !important; }\n\n        .custom-variation-button {\n            background-color: white !important;\n            color: black !important;\n            padding: 14px 100px !important;\n            border: 1px solid !important;\n            border-radius: 25px;\n            text-transform: none !important;\n            cursor: pointer;\n            font-size: 17px !important;\n        }\n        @media (max-width: 768px) {\n            .custom-variation-button {\n                width: 88vw !important; \/* width on mobile *\/\n            }\n        }\n\n        .variation-overlay {\n            position: fixed;\n            top: 0px; left: 0;\n            width: 100vw;\n            height: 100vh;\n            background: rgba(0,0,0,0.4);\n            z-index: 9998;\n            display: none;\n        }\n\n        .variation-overlay.active {\n            display: block;\n        }\n\n        .custom-variation-panel {\n            position: fixed;\n            top: 0px;\n            right: -100%;\n            width: 340px;\n            height: 100%;\n            background: #fff;\n            box-shadow: -2px 0 5px rgba(0,0,0,0.2);\n            transition: right 0.3s ease-in-out;\n            padding: 20px 15px;\n            z-index: 9999;\n            overflow-y: auto;\n        }\n\n        .custom-variation-panel.active {\n            right: 0;\n        }\n\n        .custom-variation-panel .custom-variation-option {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 10px;\n            padding: 5px 5px !important;\n            background: #ebebeb;\n            border-radius: 5px;\n            transition: background 0.2s ease;\n            color: black;\n            font-weight: 400;\n            font-size: 12px;\n        }\n\n        .custom-variation-option .variation-left {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            font-weight: 400;\n        }\n\n        .custom-variation-option .variation-right {\n            white-space: nowrap;\n            font-weight: 400;\n        }\n\n        .custom-variation-panel .custom-variation-option:hover {\n            background: #f0f0f0;\n            cursor: pointer;\n        }\n\n        .custom-variation-panel .custom-variation-option.selected {\n            background: gray;\n            color: white;\n        }\n\n        .custom-variation-panel .custom-variation-option.disabled {\n            background: #f5f5f5;\n            color: #999;\n            cursor: not-allowed;\n        }\n\n        .close-variation-panel {\n            position: fixed;\n            top: 30px;\n            right: 320px;\n            background: transparent !important;\n            border: none;\n            color: white;\n            font-size: 40px;\n            z-index: 10000;\n            cursor: pointer;\n            line-height: 1;\n            padding: 0;\n        }\n\n        .close-variation-panel i {\n            font-size: 20px;\n            background: transparent;\n        }\n\n        .close-variation-panel.hidden {\n            display: none;\n        }\n\n        .single_add_to_cart_button.disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n        }\n    <\/style>';\n\n    echo '<button type=\"button\" class=\"custom-variation-button\" id=\"open-variation-panel\">Velg st\u00f8rrelse<\/button>';\n    echo '<div class=\"variation-overlay\" id=\"variationOverlay\"><\/div>';\n    echo '<button type=\"button\" class=\"close-variation-panel hidden\" id=\"closeVariationPanel\" ><i class=\"fa-solid fa-x\"><\/i><\/button>';\n    echo '<div class=\"custom-variation-panel\" id=\"variationPanel\">';\n\t\n    echo '<div class=\"\" id=\"\" style=\"color:black; margin-bottom: 20px !important;\">Velg st\u00f8rrelse:<\/div>';\n    echo '<div style=\"margin-bottom: 25px; border-top: 1px solid #ddd;\"><\/div>';\n\t\n    foreach ($available_variations as $variation) {\n        $variation_obj = wc_get_product($variation['variation_id']);\n        $stock_quantity = $variation_obj->get_stock_quantity();\n        $is_in_stock = $variation_obj->is_in_stock();\n        $variation_id = $variation['variation_id'];\n        $attributes_data = $variation['attributes'];\n        $size_label = implode('\/', array_values($attributes_data));\n\n        if ($is_in_stock) {\n            $dot = '<span style=\"color:green; font-size:18px;\">\u25cf<\/span>';\n            if ($stock_quantity === null || $stock_quantity > 2) {\n                $stock_text = 'P\u00e5 lager';\n            } elseif ($stock_quantity <= 2 && $stock_quantity > 0) {\n                $stock_text = 'Kun ' . $stock_quantity . ' igjen';\n            } else {\n                $stock_text = 'P\u00e5 lager';\n            }\n        } else {\n            $dot = '<span style=\"color:red; font-size:18px;\">\u25cf<\/span>';\n            $stock_text = 'Utsolgt';\n        }\n\n        $attr_json = htmlspecialchars(json_encode($attributes_data), ENT_QUOTES, 'UTF-8');\n\n        echo \"<div \n            class='custom-variation-option' \n            data-variation-id='{$variation_id}' \n            data-attributes='{$attr_json}'>\n            <span class='variation-left'>\n                {$dot} <strong>{$size_label}<\/strong>\n            <\/span>\n            <span class='variation-right'>{$stock_text}<\/span>\n          <\/div>\";\n    }\n\n    echo '<\/div>'; \/\/ close panel\n    ?>\n\n    <script>\n        document.addEventListener('DOMContentLoaded', function () {\n            const isQuickView = document.querySelector('.woosq-product') !== null;\n            if (isQuickView) {\n\/\/                 console.log('In WPC Smart Quick View sidebar, skipping custom variation selector');\n                return;\n            }\n\n            const options = document.querySelectorAll('.custom-variation-option');\n            const form = document.querySelector('form.variations_form');\n            const openBtn = document.getElementById('open-variation-panel');\n            const closeBtn = document.getElementById('closeVariationPanel');\n            const overlay = document.getElementById('variationOverlay');\n            const panel = document.getElementById('variationPanel');\n            const addToCartBtn = document.querySelector('.single_add_to_cart_button');\n\n            \/\/ Check for variation styling\n            const hasVariationStyling = form.querySelector('div.variation-styling ul.variable-items-wrapper.button-variable-items-wrapper.wvs-style-rounded') !== null;\n            if (hasVariationStyling) {\n                form.classList.add('has-variation-styling');\n            } else {\n\/\/                 console.log('Variation-styling with button variations not found, skipping custom variation selector');\n                return;\n            }\n\n            \/\/ Disable Add to Cart button by default\n            if (addToCartBtn) {\n                addToCartBtn.classList.add('disabled');\n                addToCartBtn.disabled = true;\n            }\n\n            function openPanel() {\n                panel.classList.add('active');\n                overlay.classList.add('active');\n                closeBtn.classList.remove('hidden');\n            }\n\n            function closePanel() {\n                panel.classList.remove('active');\n                overlay.classList.remove('active');\n                closeBtn.classList.add('hidden');\n            }\n\n            function resetVariationSelection() {\n                \/\/ Reset form select elements\n                const selects = form.querySelectorAll('select');\n                selects.forEach(select => {\n                    select.value = '';\n                    select.dispatchEvent(new Event('change', { bubbles: true }));\n                    select.dispatchEvent(new Event('blur', { bubbles: true }));\n                });\n\n                \/\/ Remove selected class from options\n                options.forEach(opt => opt.classList.remove('selected'));\n\n                \/\/ Reset button text\n                openBtn.textContent = 'Velg st\u00f8rrelse';\n\n                \/\/ Disable Add to Cart button\n                if (addToCartBtn) {\n                    addToCartBtn.classList.add('disabled');\n                    addToCartBtn.disabled = true;\n                }\n\n                \/\/ Trigger WooCommerce variation check\n                if (typeof jQuery !== 'undefined') {\n                    jQuery(form).trigger('check_variations');\n                }\n            }\n\n            openBtn.addEventListener('click', function (e) {\n                e.preventDefault();\n                openPanel();\n            });\n\n            closeBtn.addEventListener('click', closePanel);\n            overlay.addEventListener('click', closePanel);\n\n            options.forEach(option => {\n                if (option.innerHTML.includes('Utsolgt')) {\n                    option.classList.add('disabled');\n                    option.setAttribute('title', 'Out of stock');\n                }\n                option.addEventListener('click', function () {\n                    if (this.classList.contains('disabled')) return;\n\n                    options.forEach(opt => opt.classList.remove('selected'));\n                    this.classList.add('selected');\n\n                    const attributes = JSON.parse(this.getAttribute('data-attributes'));\n                    const variationLabel = this.querySelector('.variation-left strong')?.textContent?.trim() || 'Velg st\u00f8rrelse';\n                    openBtn.textContent = variationLabel;\n\n                    Object.keys(attributes).forEach(attr_name => {\n                        const select = form.querySelector(`[name=\"${attr_name}\"]`);\n                        if (select) {\n                            select.value = attributes[attr_name];\n                            select.dispatchEvent(new Event('change', { bubbles: true }));\n                            select.dispatchEvent(new Event('blur', { bubbles: true }));\n                        }\n                    });\n\n                    \/\/ Enable Add to Cart button\n                    if (addToCartBtn) {\n                        addToCartBtn.classList.remove('disabled');\n                        addToCartBtn.disabled = false;\n                    }\n\n                    if (typeof jQuery !== 'undefined') {\n                        jQuery(form).trigger('check_variations');\n                    }\n\n                    closePanel();\n                });\n            });\n\n            \/\/ Reset variation after adding to cart\n            if (typeof jQuery !== 'undefined') {\n                jQuery(document).on('added_to_cart', function () {\n                    resetVariationSelection();\n                });\n            }\n        });\n    <\/script>\n    <?php\n}","active":true,"modified":"2025-06-03 12:27:45","revision":"194"}]}